name: 'Publish on GitHub Pages'
description: 'Publish a workflow artifact on GitHub Pages and link to it'
inputs:
  GH_PAGES_BRANCH:
    description: 'Branch for GitHub Pages content'
    required: false
    default: 'gh-pages'
  GH_PAGES_URL:
    description: 'GitHub Pages URL for current repo'
    required: true
  FILE_NAME:
    description: 'Name of file to be published'
    required: true
  COMMIT_MESSAGE:
    description: 'Commit message when pushing to GitHub Pages branch'
    required: true
  LINK_TEXT:
    description: 'Text to display on link to file'
    required: true

runs: 
  using: 'composite'
  steps:
    - run: |
        export CURRENT_BRANCH=${GITHUB_REF##*/}
        git config --global user.email ""
        git config --global user.name "Github Actions"
        git add ./$CURRENT_BRANCH/eslint-report.html
        git stash
        git fetch
        git switch ${{ inputs.GH_PAGES_BRANCH }}
        git rm --ignore-unmatch ./$CURRENT_BRANCH/*
        git checkout stash@{0} -- ./$CURRENT_BRANCH/${{ inputs.FILE_NAME }}
        git commit -am "${{ inputs.COMMIT_MESSAGE }}""
        git push -f
    - run: echo "[${{ inputs.LINK_TEXT }}](${{ inputs.GH_PAGES_URL }}/${GITHUB_REF##*/}//${{ inputs.FILE_NAME }})" >> $GITHUB_STEP_SUMMARY
      
