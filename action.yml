name: 'Mirror action'
description: 'Mirror changes to another repository'
inputs:
  refspec:
    description: 'Refspec used in push'
    required: false
    default: 'master'
  mirror-repo:
    description: 'Mirroring to'
    required: true
  ssh-private-key:
    description: 'Private key'
    required: true
runs:
  using: 'composite'
  steps:
    - name: Mask repo
      run: |
          DT_MIRROR_REPO=${{ inputs.mirror-repo }}
          echo "::add-mask::$DT_MIRROR_REPO"
          echo "DT_MIRROR_REPO=$DT_MIRROR_REPO" >> $GITHUB_ENV
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - uses: webfactory/ssh-agent@v0.6.0
      with:
        ssh-private-key: ${{ inputs.ssh-private-key }}
    - run: git push --follow-tags $DT_MIRROR_REPO ${{ inputs.refspec }}
      shell: bash
